{% extends "layout.html" %}

{% block head %}
<script src="{{url_for('static', filename='js/exdb.js')}}"></script>
<script>
    tagfiltersUrl='{{url_for("tagfilters")}}';
    searchUrl='{{url_for("search")}}';
    $( function() {
        // image tooltips for exercise and solution flags
        enableImgTooltips();
        // initialize the tag filters list
        updateTagFilters();
        searchExercises();
        $("#clearfilters").click( clearFilters );
    });
</script>
{% endblock %}

{% block body %}
<!-- A checkable button for each available tag to filter exercises -->
<div id="filterdiv">
    <div id="tagfilters"></div>
    <a id="clearfilters" href="#">clear filters</a>
</div>


<!-- the list of exercises matching the filter (generated dynamically by ajax calls)-->
<ul class="exerciselist">
</ul>

<!-- confirm dialog for removing exercises; normally hidden -->
<div id="confirm_remove" title="Really delete exercise?">
<p id="remove_dialog_message"><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span></p>
</div>


<script>
    $( function() {
        $(document).on("click", ".removelink", function(event) {
            event.preventDefault();
            table = $(this).closest(".exercise_listentry");
            creator = table.attr("creator");
            number = table.attr("number");
            $("#remove_dialog_message").text("Are you sure to remove exercise '" + creator + number + "'?");
            $("#confirm_remove").data("creator", creator);
            $("#confirm_remove").data("number", number);
            $("#confirm_remove").dialog("open");
        });
        $("#confirm_remove").dialog({
            autoOpen:false,
            resizable:false,
            modal:true,
            buttons:{
                Ok: function() {
                    creator = $(this).data("creator");
                    number = $(this).data("number");
                    $.post(
                        '{{url_for("remove")}}',
                        { creator: creator, number: number },
                        function(resp) {
                           $('.exercise_listentry[creator="' + creator + '"][number="' + number + '"]').remove();
                           updateTagFilters();
                        }
                    );
                    $(this).dialog("close");
                },
                Cancel: function() {
                    $(this).dialog("close");
                }
            }
        });            
    });        
</script>
{% endblock %}
