{% extends "layout.html" %}

{% block body %}
<!-- filters: tag tree, language filters, and description search box -->
<div id="filterdiv">
    <div id="tagtree"></div>
    {% for lang in "DE", "EN" %}
    <input type="checkbox" lang="{{lang}}" class="filterbutton" id="langfilterbutton{{lang}}"/><label class="filtertext" for="langfilterbutton{{lang}}">{{lang}}</label>
    {% endfor %}
    <div id="descriptionsearch" class="ui-state-default ui-widget">
        <label for="searchfield">Search in description:</label>
        <input type="text" id="searchfield" size="50" class="text ui-widget-content ui-corner-all"></input>
    </div>
    <a id="clearfilters" href="#">clear filters</a>
</div>

<!-- the list of exercises matching the filter (generated dynamically by ajax calls)-->
<ul id="exerciselist">
</ul>

<!-- confirm dialog for removing exercises; normally hidden -->
<div id="confirm_remove" title="Really delete exercise?">
<p id="remove_dialog_message"><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span></p>
</div>

<script>
    $( function() {
        // image tooltips for exercise and solution flags
        enableImgTooltips();
        $("#clearfilters").click( clearFilters );
        makeTagTree(false)
        .dynatree("option", "checkbox", true)
        .dynatree("option", "onSelect", searchExercises);
        $(".filterbutton").button().click( searchExercises );
        $("#searchfield").keyup(function(event) {
            var val = $(this).val();
            setTimeout(function() {
                if ($("#searchfield").val() == val)
                    searchExercises();
                }, 200);
        });
        searchExercises();
        // open confirm dialog if removelink is clicked
        $(document).on("click", ".removelink", function(event) {
            event.preventDefault();
            table = $(this).closest(".exercise_listentry");
            creator = table.attr("creator");
            number = table.attr("number");
            $("#remove_dialog_message").text("Are you sure to remove exercise '" + creator + number + "'?");
            $("#confirm_remove").data("creator", creator);
            $("#confirm_remove").data("number", number);
            $("#confirm_remove").dialog("open");
        });
        $("#confirm_remove").dialog({
            autoOpen:false, resizable:false, modal:true,
            buttons: {
                Ok: function() {
                    creator = $(this).data("creator");
                    number = $(this).data("number");
                    $.post(
                        '{{url_for("remove")}}',
                        { creator: creator, number: number },
                        function(resp) {
                           $('.exercise_listentry[creator="' + creator + '"][number="' + number + '"]').remove();
                           $("#tagtree").dynatree("getTree").reload();
                           searchExercises();
                        }
                    );
                    $(this).dialog("close");
                },
                Cancel: function() {
                    $(this).dialog("close");
                }
            }
        });
    });        
</script>
{% endblock %}
