{% extends "layout.html" %}

{% block head %}
<script src="{{url_for('static', filename='js/codemirror.js')}}"></script>
<link rel="stylesheet" href="{{url_for('static', filename='css/codemirror.css')}}"></link>
<script src="{{url_for('static', filename='js/codemirror-stex.js')}}"></script>
<script>
    rpclatexUrl='{{url_for("rpclatex")}}';
    listUrl='{{url_for("list")}}';
    mode={% if exercise %}"edit"{% else %}"add"{% endif %};
    $.get("{{url_for("tags")}}", function(data) {
        availableTags = data["tags"];
    });
</script>
<script src="{{url_for('static', filename='js/add.js')}}"></script>

{% if exercise %}
    <script>
        $( function() {
            $("#description").val("{{exercise.description}}");
            $("#tags").val("{{",".join(exercise.tags)}}");
            {% for line in exercise.tex_preamble %}
                addPreambleLine("{{line.replace('\\', '\\\\')}}");
            {% endfor %}
            {% for (typ, texdict) in ("exercise", exercise.tex_exercise), ("solution", exercise.tex_solution) %}
                {% for lang in texdict %}
                    editors["{{typ+lang}}"].setValue("{{texdict[lang]}}");
                {% endfor %}
            {% endfor %}
        });
    </script>
{% endif %}

{% endblock %}

{% block body %}
<h1>{% if exercise %}
        Modify exercise {{exercise.identifier()}}
    {% else %}
        New Exercise
    {% endif %}
</h1>

<form>
<fieldset>
<label for="description">Description</label>
<input type="text" name="description" id="description" class="text ui-widget-content ui-corner-all"></input>
<label for="tags">Tags</label>
<input name="tags" id="tags" class="text ui-widget-content ui-corner-all" />
<label for="preamble">Preamble</label>
<ul id="preambles">
</ul>
<button id="addpreamble">add line</button>

{% for typ in ("exercise", "solution") %}
    <h2>{{typ}} tex code</h2>
    <div class="textabs">
        <ul>
            {% for lang in "DE", "EN" %}
              <li><a href="#textab_{{typ}}_{{lang}}">{{lang}}</a></li>
            {% endfor %}
        </ul>
        {% for lang in "DE", "EN" %}
            <div id="textab_{{typ}}_{{lang}}" lang="{{lang}}" textype="{{typ}}" class="textab">
                <img class="texpreview"/>
                <div class="errorlog"><label class="errormsg">Error compiling source</label><pre></pre></div>
                <textarea class="latexeditor ui-widget-content"></textarea>
                <button class="compilebutton">compile</button>
            </div>
        {% endfor %}
    </div>
{% endfor %}
</fieldset>
</form>
<button id="submitbutton">submit</button>
{% endblock %}
